const chai=require("chai"),expect=chai.expect,TodoApi=require("./TodoApi"),TodoRequestOptions=require("./TodoRequestOptions"),nock=require("nock"),url=require("url");function parsedUrl(e,t){var o=e.getUrl(t),d=url.parse(o);return{host:d.protocol+"//"+d.hostname,path:d.pathname}}describe("TodoApi",(()=>{const e=new TodoRequestOptions("http://mockedapi.test/","todo/"),t=new TodoApi(e);it("getList() should return 6 mocked itens",(o=>{var d={},r=parsedUrl(e,d);nock(r.host,{reqheaders:{"Content-Type":"application/json"}}).get(r.path).reply(200,[{_id:"59ac76d803ffa8151932d6fb",description:"test5",createdAt:"2017-09-03T21:40:40.891Z",done:!1},{_id:"59b299ff747883040351430c",description:"test1",createdAt:"2017-09-08T13:24:15.711Z",done:!1},{_id:"59b29a10747883040351430d",description:"test2",createdAt:"2017-09-08T13:24:32.075Z",done:!1},{_id:"59b29a16747883040351430e",description:"test3",createdAt:"2017-09-08T13:24:38.064Z",done:!1},{_id:"59b29a1f747883040351430f",description:"test4",createdAt:"2017-09-08T13:24:47.393Z",done:!1}]),t.getList(d).then(((e,t)=>{expect(e).to.be.an("array").to.have.lengthOf(5),o()})).catch((e=>o(e)))})),it("getDetail() should return mocked item",(o=>{var d={id:"59b29a10747883040351430d"},r=parsedUrl(e,d),i={_id:d.id,description:"test2",createdAt:"2017-09-08T13:24:32.075Z",done:!1};nock(r.host,{reqheaders:{"Content-Type":"application/json"}}).get(r.path).reply(200,i),t.getDetail(d).then(((e,t)=>{expect(e).to.be.an("object"),expect(e._id).to.equal(i._id),expect(e).to.deep.equal(i),o()})).catch((e=>o(e)))})),it("create() should return mocked new item",(o=>{var d=parsedUrl(e),r={description:"test2",done:!1},i={_id:"19304h13f893egf",description:r.description,createdAt:"2017-09-08T13:24:32.075Z",done:!1};nock(d.host,{reqheaders:{"Content-Type":"application/x-www-form-urlencoded"}}).matchHeader("accept","application/json").post(d.path).reply(200,i),t.create(r).then(((e,t)=>{expect(e).to.have.deep.property("_id",i._id),expect(e).to.deep.equal(i),o()})).catch((e=>o(e)))})),it("update() should return updated item",(o=>{var d={id:"59b29a10747883040351430d"},r=parsedUrl(e,d),i={description:"test3",done:!0},a={_id:d.id,description:i.description,createdAt:"2017-09-08T13:24:32.075Z",done:i.done};nock(r.host,{reqheaders:{"Content-Type":"application/x-www-form-urlencoded"}}).put(r.path).reply(200,a),t.update(d,i).then(((e,t)=>{console.log(e),expect(e).to.have.deep.property("_id",a._id),expect(e).to.deep.equal(a),o()})).catch((e=>o(e)))})),it("delete() should return null",(o=>{var d={id:"59b29a10747883040351430d"},r=parsedUrl(e,d);nock(r.host).delete(r.path).reply(200,""),t.delete(d).then(((e,t)=>{o()})).catch((e=>o(e)))}))}));